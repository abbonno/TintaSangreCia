---
import Layout from "../layouts/Layout.astro";
import { convertirDocxAHtml } from "../lib/docxToHtml.js";

const htmlLibro = await convertirDocxAHtml();
---

<Layout>
  <main class="bg-[#111] text-white min-h-screen flex flex-col items-center justify-center py-8 select-none">
    <h1 class="text-2xl mb-4">Visor de Libro</h1>

    <!-- Contenedor del libro -->
    <div id="contenido" class="bg-white text-black p-6 w-[90vw] max-w-4xl h-[80vh] overflow-auto">
      <Fragment set:html={htmlLibro} />
    </div>
  </main>

  <script type="text/javascript" is:inline>
    let comentarios = [];

    const contenedor = document.getElementById("contenido");

    contenedor.addEventListener("mouseup", () => {
      const seleccion = window.getSelection();
      const texto = seleccion.toString();

      if (texto.trim()) {
        const rango = seleccion.getRangeAt(0);
        const span = document.createElement("span");
        span.className = "bg-yellow-300";
        rango.surroundContents(span);

        comentarios.push({
          texto: texto,
          fecha: new Date().toISOString()
        });

        console.log("Comentarios:", comentarios);
      }
    });
  </script>
</Layout>
